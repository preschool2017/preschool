!function(i){var n={initialize:function(){this.bind_events()},formatString:function(){var i=arguments;return this.replace(/{(\d+)}/g,function(n,e){return"undefined"!=typeof i[e]?i[e]:n})},setTriggerProof:function(i,n){var e=i.data("class-on"),g=i.data("class-off");i.data("proofed",n?"1":"0"),n?(i.removeClass(g),i.addClass(e),i.addClass("ngg-proofing-on")):(i.removeClass(e),i.addClass(g),i.removeClass("ngg-proofing-on"))},removeAllProofs:function(n){var e=this,g=e.getList(n);g.length<=0||(i(".ngg-trigger-proofing").each(function(i,g){var o=jQuery(g),a=(o.data("image-id"),o.data("nplmodal-gallery-id"));return a!=n||void e.setTriggerProof(o,!1)}),Ngg_Store.set("ngg_proofing_"+n,""))},setActiveTriggers:function(n){var e=this,g=e.getList(n);g.length<=0||i(".ngg-trigger-proofing").each(function(i,o){var a=jQuery(o),r=a.data("image-id"),t=a.data("nplmodal-gallery-id");return t!=n||void(g.indexOf(r.toString())>-1&&e.setTriggerProof(a,!0))})},getDialog:function(n){var e=this,g=jQuery("#ngg-proofing-dialog-"+n);if(0==g.length){var o=e.getList(n),a=e.formatString.call(ngg_pro_proofing_i18n.image_list,o.length,1!=o.length?"s":""),r="";o.length<=0&&(r=' disabled="disabled" ');var t='<div id="ngg-proofing-dialog-'+n+'" class="ngg-proofing-dialog" style="display:none;">';t+='<a href="javascript:void(0)" class="ngg-proofing-cancel">',t+='<span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-times fa-stack-1x"></i></span>',t+="</a>",t+='<h3 class="ngg-proofing-label">'+a+"</h3>",t+='<div class="ngg-proofing-form">',t+='<div class="ngg-proofing-form-entry">',t+='<input type="hidden" class="ngg-proofing-list" name="list" value=""/>',t+='<div class="ngg-proofing-fullname-wrapper">',t+='<span><i class="fa fa-fw fa-user"></i></span>',t+='<input type="text" required class="ngg-proofing-fullname" name="customer_name" placeholder="'+ngg_pro_proofing_i18n.example_name+'"/>',t+="</div>",t+='<div class="ngg-proofing-email-wrapper">',t+='<span><i class="fa fa-fw fa-envelope"></i></span>',t+='<input type="email" required class="ngg-proofing-email" name="email" placeholder="'+ngg_pro_proofing_i18n.example_email+'"/>',t+="</div>",t+="</div>",t+='<div class="ngg-proofing-form-entry ngg-form-entry-submit">',t+='<button class="ngg_pro_btn ngg-proofing-submit" type="submit" name="submit"'+r+">"+ngg_pro_proofing_i18n.submit_button+'&nbsp;<i class="fa fa-arrow-circle-right"></i></button>',t+="</div>",t+="</div></div>",g=i(t),i(g).find(".ngg-proofing-fullname, .ngg-proofing-email").each(function(){i(this).placeholder()}),g.find(".ngg-proofing-cancel").click(function(n){n.preventDefault(),i("html, body").removeClass("ngg_proofing_form_open"),g.hide(),i("#ngg_proofing_overlay").hide()}),g.find(".ngg-proofing-submit").click(function(o){o.preventDefault();var a=g.find(".ngg-proofing-email"),r=g.find(".ngg-proofing-fullname"),t=e.getList(n),l=g.find(".ngg-proofing-submit");l.html(ngg_pro_proofing_i18n.submit_message),l.attr("disabled","disabled"),i.post(photocrati_ajax.url,{action:"submit_proofed_gallery",email:a.attr("value"),customer_name:r.attr("value"),proofed_gallery:{image_list:t}},function(o){"string"==typeof o&&(o=JSON.parse(o)),o.error?alert(o.error):o.message&&"Done"==o.message&&(e.removeAllProofs(n),g.hide(),i("#ngg_proofing_overlay").hide(),o.redirect&&(window.location=o.redirect)),l.html(ngg_pro_proofing_i18n.submit_button),l.removeAttr("disabled")})}),g.appendTo(document.body)}return g},getList:function(i){var n=[],e=Ngg_Store.get("ngg_proofing_"+i);return e&&(n=e.split(",")),n},updateAllGalleries:function(){var n=this;i.each(galleries,function(i,e){n.setActiveTriggers(e.ID)})},setDialogStrings:function(i,n){var e=this;i.find(".ngg-proofing-list").val(n.join(","));var g=i.find(".ngg-proofing-label");g.html(e.formatString.call(ngg_pro_proofing_i18n.image_list,n.length,1!=n.length?"s":"")),n.length>0?i.find(".ngg-proofing-submit").removeAttr("disabled"):i.find(".ngg-proofing-submit").attr("disabled","disabled")},addOrRemoveImage:function(n,e){var g=this,o=g.getDialog(n),a=g.getList(n),r=a.indexOf(e.toString());return r>-1?(a.splice(r,1),i(".ngg-trigger-proofing").each(function(i,o){var a=jQuery(o),r=a.data("nplmodal-gallery-id");return r!=n||void(a.data("image-id")==e&&g.setTriggerProof(a,!1))})):a.push(e.toString()),Ngg_Store.set("ngg_proofing_"+n,a.join(",")),g.setActiveTriggers(n),g.setDialogStrings(o,a),a},bind_events:function(){var n=this;i(function(){i("body").append('<div id="ngg_proofing_overlay" style="display: none;"></div>'),n.updateAllGalleries()}),i(document).on("ngg-captions-added",function(){n.updateAllGalleries()}),i(document).on("ngg-caption-add-icons",function(e,g){if(i.nplModal("get_displayed_gallery_setting",g.gallery_id,"ngg_proofing_display",!1)){var o=i("<i/>",{class:"fa fa-star ngg-trigger-proofing ngg-caption-icon","data-nplmodal-gallery-id":g.gallery_id,"data-nplmodal-image-id":g.image_id,"data-image-id":g.image_id}).on("click",function(i){return i.preventDefault(),n.addOrRemoveImage(g.gallery_id,g.image_id),!1});g.el.append(o)}}),i(document).on("refreshed",function(i){n.updateAllGalleries()}),i(document).on("click",".ngg-pro-proofing-trigger-link",function(e){e.preventDefault();var g=n.getDialog(i(this).data("gallery-id"));i("#ngg_proofing_overlay").show(),i("html, body").addClass("ngg_proofing_form_open"),g.show()}),i(document).on("click",".ngg-trigger-proofing",function(i){var e=jQuery(this),g=e.data("nplmodal-gallery-id"),o=e.data("image-id");n.addOrRemoveImage(g,o)})}};n.initialize(),window.ngg_image_proofing=n}(jQuery);