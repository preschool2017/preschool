function photocrati_autoupdate_string_format(){var t=arguments;try{return this.replace(/{(\d+)}/g,function(a,e){return"undefined"!=typeof t[e]?t[e]:a})}catch(t){return this}}function photocrati_autoupdate_readable_size(t){var a=["Bytes","KiB","MiB","GiB","TiB"];if(0==t)return"number"==typeof t?"0 bytes":"n/a";var e=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return Math.ceil(t/Math.pow(1024,e),2)+" "+a[e]}function photocrati_autoupdate_expand_json(t){var a=null;try{a=jQuery.parseJSON(t)}catch(e){a=jQuery.parseJSON(jQuery("<div/>").html(t).text())}return a}String.prototype.format=function(){return photocrati_autoupdate_string_format.apply(this,arguments)};var Photocrati_AutoUpdate_Admin={performRequest:function(t,a){void 0!=a&&null!=a||(a={})},updateStart:function(t,a){var e=t.find(".details .message"),n=t.find(".details .log"),i=t.find(".progress-bar");e.html(a.updater_status_preparing),t.data("update-index",0),t.data("update-stage","download"),n.html(""),i.progressbar("option","value",1),i.show(),this.updateContinue(t,a)},updateContinue:function(t,a){var e=t.find(".details .message"),n=t.find(".details .log"),i=t.find(".progress-bar"),d=t.data("update-list"),r=t.data("update-index")||0,o=t.data("update-stage");if(r>=d.length){switch(o){case"download":t.data("update-stage","install");break;case"install":t.data("update-stage","activate");break;case"activate":t.data("update-stage","cleanup")}var s=t.data("update-stage");if(o==s)return e.html('<span style="color:#44aa44;font-weight:bold;">'+a.updater_status_done+"</span>"),t.find(".details .button-update-start").hide(),t.find(".details .button-update-done").css("display","inline"),n.append("Update Completed.\n"),void i.progressbar("option","value",100);n.append('Completed queue for stage "{0}", next queue stage is "{1}".\n'.format(o,s)),t.data("update-index",0),r=t.data("update-index")||0,o=s}var p=d[r],u=p.info,l=u["-command-stage"]||"download",c="updater_status_stage_"+o;if(c in a&&e.html(a["updater_status_stage_"+o].format(d.length,r+1)),l==o){var f=t.data("form-submit-data")||{},m='Performing stage "{1}" request for "{0}"...';f.action="photocrati_autoupdate_admin_handle",f.actionSec=Photocrati_AutoUpdate_Admin_Settings.actionSec,"activate"==o?(n.append(m.format("&lt;All&gt;",o)),f["update-action"]="handle-list",f["update-list"]=d):(n.append(m.format(u["module-id"],l)),f["update-action"]="handle-item",f["update-item"]=p),jQuery.ajax({type:"POST",url:Photocrati_AutoUpdate_Admin_Settings.ajaxurl,data:f}).success(function(t,a){return function(e,i,d){if("string"==typeof e)n.append('Possibly Failed...wrong output generated ["{0}"].\n'.format(e));else if(n.append("Success.\n"),"action"in e)t[a]=e;else if(e.length>0&&"action"in e[0]){t.splice(0,t.length);for(var r=0;r<e.length;r++)t.push(e[r])}}}(d,r)).error(function(t,a){return function(t,a,e){n.append('Failed ["{0}"].\n'.format(e))}}(d,r)).complete(function(d,r){var o=function(d,r){var o=t.data("update-stage"),s=d[r],p=s.info,u=null,l=!0;if(p["-command-error"]&&(u=p["-command-error"],n.append('An error occurred ["{2}"] at stage "{0}" for "{1}" {3}.\n'.format(o,p["module-id"],u,p["module-version"])),p["-command-form"])){l=!1,n.append("Displaying FTP credentials form...");var c=jQuery("<div>"+p["-command-form"]+"</div>").find("form"),f=t.data("form-submit-data");if(f)for(var m in f)c.find("[name="+m+"]").val(f[m]);c.data("submit-ok",!1),c.submit(function(){return c.data("submit-ok",!0),c.dialog("close"),!1}),c.find(".wrap .icon32").attr("id","icon-index"),c.dialog({title:"Connection Details",width:550,modal:!0,resizable:!1,close:function(){if(1==c.data("submit-ok")){n.append("Done.\n");var d=c.serializeArray(),r={};for(var o in d)r[d[o].name]=d[o].value;t.data("form-submit-data",r),Photocrati_AutoUpdate_Admin.updateContinue(t,a)}else n.append("Canceled.\n"),e.html(a.updater_status_cancel),i.progressbar("option","value",0)}})}if(l){var _={download:.6,install:.3,activate:.05,cleanup:.05},g=i.progressbar("option","value"),h=99*_[o]/d.length,v='{0} stage "{3}" for ({2}) "{1}"{5}. Next stage is "{4}".\n',b=u?"Skipped":"Completed",y="download"==o&&!u,j=y?', stored into "{0}"'.format(p["-command-package-file"]):"";i.progressbar("option","value",g+h),n.append(v.format(b,p["module-id"],r,o,p["-command-stage"],j)),t.data("update-index",r+1),Photocrati_AutoUpdate_Admin.updateContinue(t,a)}};return function(a,e){t.data("update-stage");o(d,r)}}(d,r))}else n.append('Skipping ({1}) "{0}" in stage "{2}" while performing stage "{3}"...\n'.format(u["module-id"],r,l,o)),t.data("update-index",r+1),this.updateContinue(t,a)}};jQuery(document).ready(function(){var t=jQuery("#update-content"),a=jQuery("#update-loader");if(0!=t.length){var e=jQuery("<div />"),n=photocrati_autoupdate_expand_json(Photocrati_AutoUpdate_Admin_Settings.update_list),i=photocrati_autoupdate_expand_json(Photocrati_AutoUpdate_Admin_Settings.text_list),d=null;if(n.length>0){for(var r=0,o=0,s=0,p=null,u=null,l=0,c=0,f=0;f<n.length;f++){var m=n[f],_=m.info;if("product-invalid-license"in _){if(o++,"product-invalid-license-link"in _){var g=_["product-invalid-license-link"];null==p&&(p=g)}}else if("product-expired"in _){if(s++,"product-expired-link"in _){var g=_["product-expired-link"];null==u&&(u=g)}}else c+=_["module-package-size"];l+=_["module-package-size"],r++}if(r>0){var h=r-(o+s);if(l=photocrati_autoupdate_readable_size(l),c=photocrati_autoupdate_readable_size(c),e.append('<div class="details"><span class="update-info">'+i.updates_available.format(r,h)+"</span></div>"),o>0&&(p+=p.indexOf("?")==-1?"?":"&",p+="pclst="+escape(Photocrati_AutoUpdate_Admin_Settings.request_site),e.append('<div class="details details-alert"><span class="message">'+i.updates_license_invalid.format(o,r,"")+'</span> &nbsp; <a href="'+p+'" class="button-secondary" target="_blank">'+i.updates_license_get+"</a></div>")),s>0&&(u+=u.indexOf("?")==-1?"?":"&",u+="pclst="+escape(Photocrati_AutoUpdate_Admin_Settings.request_site),e.append('<div class="details details-alert"><span class="message">'+i.updates_expired.format(s,r,"")+'</span> &nbsp; <a href="'+u+'" class="button-secondary" target="_blank">'+i.updates_renew+"</a></div>")),h>0){d=jQuery('<div class="updater" id="update-updater" />');var v=jQuery('<span class="message"></span>'),b=jQuery('<pre class="log"></pre>'),y=jQuery('<div class="progress-bar" />').progressbar(),j=null;d.data("update-list",n),v.html(i.updater_status_start);var A=null;A=jQuery('<div class="details"></div>'),A.append(v),d.append(A),A=jQuery('<div class="details"></div>');var Q=jQuery('<button class="button-secondary download-log" style="visibility:hidden">'+i.updater_logger_download+"</button>"),x=jQuery('<span class="show-log-button">'+i.updater_logger_title+"</span>").css({cursor:"pointer"}).hide().click(function(t){return t.preventDefault(),jQuery(this).parent().find(".log").slideToggle(),!1});A.append(jQuery('<h4 class="show-log"></h4>').append(x).append(Q)),A.css({overflow:"auto"}),b.css({height:300}).hide(),A.append(b),j=A,Q.click(function(t){t.preventDefault();var a=d.data("form-submit-data")||{};a.action="photocrati_autoupdate_admin_handle",a.actionSec=Photocrati_AutoUpdate_Admin_Settings.actionSec,a["update-action"]="download-log",a["update-log"]=b.text();var n=jQuery("<form />");n.attr("method","POST"),n.attr("action",Photocrati_AutoUpdate_Admin_Settings.ajaxurl),n.attr("target","_blank"),n.width(1).height(1);for(var i in a){var r=jQuery('<input type="hidden" />');r.attr("name",i).val(a[i]),n.append(r)}return e.append(n),n.submit(),!1}),y.hide(),y.bind("progressbarchange",function(t,a){var e=jQuery(this).progressbar("option","value");0!=e&&100!=e||Q.css("visibility","visible")}),A=jQuery('<div class="details"></div>'),A.append(y),d.append(A),A=jQuery('<div class="details"></div>'),A.append(jQuery('<button class="button-primary button-update-start">'+i.updater_button_start+"</button>").click(function(t){t.preventDefault();var a=jQuery(this);return a.attr("disabled")||(a.attr("disabled","disabled"),Photocrati_AutoUpdate_Admin.updateStart(d,i)),!1})),A.append(jQuery('<a class="button-primary button-update-done" href="'+Photocrati_AutoUpdate_Admin_Settings.adminurl+'">'+i.updater_button_done+"</a>").hide()),d.append(A),d.append(j),e.append(d)}}}else e.append('<span class="message">'+i.no_updates+"</span>");a.remove(),t.append(e)}});