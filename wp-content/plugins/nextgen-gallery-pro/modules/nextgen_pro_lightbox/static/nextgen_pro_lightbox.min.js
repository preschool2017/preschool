!function(e){"use strict";function t(){var t={state:{slug:null,gallery_id:null,image_id:null,sidebar:null},selector:nextgen_lightbox_filter_selector(e,e(".nextgen_pro_lightbox")),options:{},defaults:{speed:"medium",initial_url:window.location.toString().split("#")[0],ajax_url:photocrati_ajax.url,router_slug:"gallery"},init:function(i){var n=e("<div id='npl_overlay'></div>"),a=e("<div id='npl_wrapper'></div>"),s=e("<div id='npl_spinner_container' class='npl-loading-spinner'><i id='npl_spinner' class='fa fa-spin fa-spinner hidden'></i></div>"),o=e("<div id='npl_button_close' class='hidden'><i class='fa fa-times-circle'></i></div>"),r=e("<div id='npl_content'></div>");t.methods.mobile.browser.ios()&&(n.addClass("npl_ios_no_opacity"),a.addClass("npl_ios_hack")),e(window).trigger("override_nplModal_methods",t.methods),n.css({background:t.methods.get_setting("background_color")}),s.css({color:t.methods.get_setting("icon_color")}),o.css({color:t.methods.get_setting("overlay_icon_color")});var l=e("body");if(l.append(n),l.append(a),a.append(s),a.append(o),a.append(r),i=e.extend(i,{router_slug:t.methods.get_setting("router_slug")}),t.options=e.extend(t.defaults,i),t.methods.bind_images(),t.methods.set_events(),t.methods.mobile.init(),parseInt(t.methods.get_setting("padding","0"))>0){var d=t.methods.get_setting("padding","0")+t.methods.get_setting("padding_unit","px");e("<style type='text/css'>#npl_wrapper.npl_open_with_padding {top: "+d+";bottom: "+d+";left: "+d+";right: "+d+"; } </style>").appendTo("head")}t.methods.router.routes.push({re:new RegExp("^"+t.options.router_slug+"/(.*)/(.*)/(.*)$","i"),handler:t.methods.url_handler}),t.methods.router.routes.push({re:new RegExp("^"+t.options.router_slug+"/(.*)/(.*)$","i"),handler:t.methods.url_handler}),t.methods.router.routes.push({re:new RegExp("^"+t.options.router_slug+"$","i"),handler:t.methods.close_modal}),t.methods.router.routes.push({re:"",handler:t.methods.close_modal}),t.methods.router.listen(),(t.methods.mobile.browser.ios()||t.methods.mobile.browser.android())&&a.addClass("npl_mobile"),t.methods.mobile.browser.any()&&t.methods.mobile.hide_triggers()},methods:{_pre_open_callbacks:[],_is_open:!1,getDPIRatio:function(){var e=1;return void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?e=window.screen.systemXDPI/window.screen.logicalXDPI:void 0!==window.devicePixelRatio&&(e=window.devicePixelRatio),e},url_handler:function(){var i=arguments[0],n=arguments[1],a=null;3==arguments.length&&(a=arguments[2],"1"==a&&(a="comments"));var s=this.get_id_from_slug(i);s||(s=i);var o={gallery_id:s,image_id:n,sidebar:a,slug:i};this.set_state(o),e("#npl_content").trigger("npl.url_handler",[o]),this.is_open()&&s==t.state.gallery_id||this.open_modal(s,n,a)},run_pre_open_lightbox_callbacks:function(e,t){for(var i=0;i<this._pre_open_callbacks.length;i++){var n=this._pre_open_callbacks[i];t=n(e,t)}return t},add_pre_open_callback:function(e){this._pre_open_callbacks.push(e)},get_state:function(){return t.state},set_state:function(e){t.state=e},get_setting:function(e,t){var i="";return i="undefined"!=typeof nplModalSettings&&"undefined"!=typeof nplModalSettings[e]&&""!==nplModalSettings[e]?window.nplModalSettings[e]:t,1==i&&(i=!0),0==i&&(i=!1),"1"==i&&(i=!0),"0"==i&&(i=!1),i},get_slug:function(t){var i=t;return"undefined"==typeof window.galleries?i:(e.each(galleries,function(e,n){n.slug&&n.ID==t&&(i=n.slug)}),i)},open:function(e){this.mobile.browser.any()&&this.fullscreen.enter();var i={show_sidebar:"",gallery_id:"!",image_id:"!",slug:null,revert_image_id:"!",open_the_lightbox:!0};e.data("nplmodal-show-comments")&&(i.show_sidebar="/comments"),e.data("nplmodal-gallery-id")&&(i.gallery_id=e.data("nplmodal-gallery-id")),e.data("nplmodal-image-id")?i.image_id=e.data("nplmodal-image-id"):e.data("image-id")?i.image_id=e.data("image-id"):"!"==i.gallery_id&&(i.image_id=e.attr("href")),"!"!==i.gallery_id&&(i.slug=this.get_slug(i.gallery_id)),i=this.run_pre_open_lightbox_callbacks(e,i),i.open_the_lightbox&&("!"!=i.gallery_id&&this.get_setting("enable_routing")?(t.methods.router.front_page_pushstate(i.gallery_id,i.image_id),this.router.navigate(t.options.router_slug+"/"+i.slug+"/"+i.image_id+i.show_sidebar),"!"!==i.revert_image_id&&(t.state.image_id=i.revert_image_id)):this.open_modal(i.gallery_id,i.image_id,null))},bind_images:function(){for(var i=nextgen_lightbox_filter_selector(e,e(".nextgen_pro_lightbox")),n=[],a=0;a<i.length;a++){var s=i[a];e(s).hasClass("photocrati_lightbox_always")||e(s).hasClass("decoy")||n.push(s)}t.selector=e(n),t.selector.on("click",function(i){e.inArray(e(this).attr("target"),["_blank","_parent","_top"])>-1||e(this).data("src")&&e(this).data("src").indexOf(t.methods.get_setting("router_slug")+"/image")!==-1&&!e(this).data("nplmodal-gallery-id")||(i.stopPropagation(),i.preventDefault(),i.handled!==!0&&(i.handled=!0,t.methods.open(e(this))))})},set_events:function(){var t=this;e(window).on("refreshed",t.bind_images),e(window).bind("keydown",t.handle_keyboard_input),e(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",t.fullscreen.event_handler),e("#npl_overlay, #npl_button_close").on("touchstart click",function(e){e.stopPropagation(),e.preventDefault(),e.handled!==!0&&(e.handled=!0,t.close_modal())})},open_modal:function(i,n,a){this._is_open=!0;var s=this;e("html, body").toggleClass("nextgen_pro_lightbox_open"),t.state.image_id=n,t.state.gallery_id=i,e("#npl_spinner, #npl_button_close").removeClass("hidden"),s.fullsize.exit(),s.mobile.open(),setTimeout(function(){var o=t.methods.fetch_images.fetch_images(i,n),r=0,l=t.methods.getDPIRatio()>1;e.each(o,function(e,t){n==t.image_id&&(r=e),"undefined"!=typeof t.full_use_hdpi&&(l&&t.full_use_hdpi?t.image=t.full_srcsets.hdpi:t.image=t.full_image)}),Galleria.run("#npl_content",{responsive:!0,thumbQuality:!1,preload:4,theme:"nextgen_pro_lightbox",dataSource:o,show:r,variation:"nggpl-variant-"+s.get_setting("style",""),transition:s.get_setting("transition_effect","slide"),touchTransition:s.get_setting("touch_transition_effect","slide"),imagePan:s.get_setting("image_pan",!1),pauseOnInteraction:s.get_setting("interaction_pause",!0),imageCrop:s.get_setting("image_crop",!0),transitionSpeed:1e3*s.get_setting("transition_speed",.4),nggSidebar:a}),e("#npl_spinner").addClass("hidden")},5)},mobile:{meta:null,original:null,adjust:!0,ontouch:!!("ontouchstart"in window),init:function(){this.ontouch||(this.adjust=!1);var e=(this.ios_version(),window.document);e.querySelector&&(this.meta=e.querySelector("meta[name=viewport]"),this.original=this.meta&&this.meta.getAttribute("content"))},open:function(){this.adjust&&this.meta&&this.meta.setAttribute("content",this.original+", width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=0, shrink-to-fit=no")},close:function(){this.adjust&&this.meta&&this.meta.setAttribute("content",this.original)},ios_version:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}},browser:{any:function(){return t.methods.mobile.browser.android()||t.methods.mobile.browser.ios()||t.methods.mobile.browser.windowsphone()||t.methods.mobile.browser.blackberry()},android:function(){return/Android/i.test(navigator.userAgent)},ios:function(){return/crios|iP(hone|od|ad)/i.test(navigator.userAgent)},windowsphone:function(){return/(iemobile|Windows Phone)/i.test(navigator.userAgent)},blackberry:function(){return/(blackberry|RIM Tablet|BB10; )/i.test(navigator.userAgent)}},hide_triggers:function(){e(".ngg-trigger").each(function(){var t=e(this);(t.hasClass("fa-comment")||t.hasClass("fa-shopping-cart"))&&t.hide()})}},close_modal:function(){if(this._is_open){var i=e("#npl_content");i.trigger("npl.closing"),this.fullsize.enter(),this.fullscreen.exit(),e("#npl_spinner, #npl_button_close").addClass("hidden"),e("html, body").toggleClass("nextgen_pro_lightbox_open"),this.mobile.close(),i.data("galleria").destroy(),this.get_setting("enable_routing")&&(history.pushState("",document.title,window.location.pathname+window.location.search),this.get_setting("is_front_page")&&history.pushState&&history.pushState({},document.title,t.options.initial_url)),this._is_open=!1}},fullsize:{_is_fullsize:!1,active:function(){return this.fullsize._is_fullsize},enter:function(){e("#npl_wrapper").removeClass("npl_open_with_padding"),this._is_fullsize=!0},exit:function(){parseInt(t.methods.get_setting("padding","0"))>0&&!t.methods.mobile.browser.ios()&&e("#npl_wrapper").addClass("npl_open_with_padding"),this._is_fullsize=!1},toggle:function(){this.fullsize._is_fullsize?this.fullsize.exit():this.fullsize.enter(),e(window).trigger("resize")}},fullscreen:{enter:function(){var e=document.getElementById("npl_wrapper");e.requestFullScreen?e.requestFullScreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},exit:function(){document.cancelFullScreen?document.cancelFullScreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},toggle:function(){this.fullscreen.has_support()&&(this.fullscreen.active()?this.fullscreen.exit():this.fullscreen.enter())},event_handler:function(){setTimeout(function(){e.nplModal("fullscreen.active")?e.nplModal("fullsize.enter"):e.nplModal("fullsize.exit")},25)},active:function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement},has_support:function(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled)}},handle_keyboard_input:function(e){t.methods.is_open()&&27==e.which&&t.methods.close_modal()},is_open:function(){return this._is_open},fetch_images:{gallery_image_cache:[],ajax_info:[],ajax_interval:null,ajax_delay:1400,is_cached:function(t,i){var n=!1;return e.each(this.gallery_image_cache[t],function(e,t){i==t.image_id&&(n=!0)}),n},fetch_images:function(i,n){var a=this;this.ajax_delay=t.methods.get_setting("ajax_delay",1400),"undefined"==typeof this.gallery_image_cache[i]&&(this.gallery_image_cache[i]=[]);var s=t.methods.get_gallery_from_id(i);if(null!==s){if(this.gallery_image_cache[i].length>0&&this.gallery_image_cache[i].length==s.images_list_count)return this.gallery_image_cache[i];e.each(s.images_list,function(e,t){a.is_cached(i,t.image_id)||a.gallery_image_cache[i].push(t)}),this.gallery_image_cache[i].length<s.images_list_count&&(this.fetch_images_from_page(i),this.is_cached(i,n)?this.fetch_images_from_ajax(i):this.fetch_images_from_ajax(i,n))}else this.fetch_images_from_page(i);return this.gallery_image_cache[i]},fetch_images_from_page:function(i){var n=this;t.selector.each(function(){var a=e(this);if(a.hasClass("ngg-trigger"))return!0;if("!"!==i&&i!==a.data("nplmodal-gallery-id"))return!0;if(i!==t.methods.get_state().gallery_id)return!0;if("!"==t.methods.get_state().gallery_id&&a.data("nplmodal-gallery-id"))return!0;var s=e(this).find("img").first(),o={},r=/\.(jpeg|jpg|gif|png|bmp)$/i;if(o.image=void 0==a.data("fullsize")?a.attr("href"):a.data("fullsize"),"undefined"!=typeof o.image&&!o.image.match(r)&&s.attr("srcset")){var l=parseSrcset(s.attr("srcset")),d=0;_.each(l,function(e){void 0!=typeof e.w&&e.w>d&&(d=e.w,o.image=e.url)})}return o.image.match(r)||(o.image=s.attr("src")),o.image_id=void 0==a.data("image-id")?o.image:a.data("image-id"),!!n.is_cached(i,o.image_id)||(void 0!==a.data("thumb")?o.thumb=a.data("thumb"):"undefined"!==a.data("thumbnail")&&(o.thumb=a.data("thumbnail")),void 0!==a.data("title")?o.title=a.data("title"):"undefined"!=typeof s.attr("title")?o.title=s.attr("title"):"undefined"!=typeof a.siblings(".wp-caption-text").html()&&(o.title=a.siblings(".wp-caption-text").html()),void 0!==a.data("description")?o.description=a.data("description"):o.description=s.attr("alt"),void n.gallery_image_cache[i].push(o))})},get_ajax_info:function(e){return"undefined"==typeof this.ajax_info[e]&&(this.ajax_info[e]={current:0,page:1}),this.ajax_info[e]},increment_ajax_page:function(e){var t=this.get_ajax_info(e);t.page++,this.update_ajax_info(e,t)},decrement_ajax_current:function(e){var t=this.get_ajax_info(e);t.current--,this.update_ajax_info(e,t)},increment_ajax_current:function(e){var t=this.get_ajax_info(e);t.current++,this.update_ajax_info(e,t)},update_ajax_info:function(e,t){this.ajax_info[e]=t},fetch_images_from_ajax:function(i,n){if(t.methods.is_open()){this.increment_ajax_current(i);var a=this,s="undefined"==typeof n||"boolean"==typeof n,o=e("#npl_content"),r=t.methods.get_gallery_from_id(i),l=e.extend({},r);return delete l.images_list,delete l.display_settings,e.ajax({async:s,url:t.options.ajax_url,method:"POST",data:{id:i,gallery:l,action:"pro_lightbox_load_images",lang:t.methods.get_setting("lang",null),page:a.get_ajax_info(i).page},dataType:"json",success:function(r){if(s){if(!t.methods.is_open())return;e.each(r,function(e,n){if(!a.is_cached(i,n.image_id)){var s=o.data("galleria");if(o.trigger("npl.newimage",{image:n}),a.gallery_image_cache[i].push(n),s.push(n),n.image_id==t.state.image_id){var r=a.gallery_image_cache[i].length-1;setTimeout(function(){s.show(r)},20)}}}),a.decrement_ajax_current(i),a.set_fetch_interval(i)}else s||(e.each(r,function(t,n){e("#npl_content").trigger("npl.newimage",{image:n}),a.gallery_image_cache[i].push(n)}),a.decrement_ajax_current(i),a.is_cached(i,n)?a.set_fetch_interval(i):(a.increment_ajax_page(i),a.fetch_images_from_ajax(i,n)))}}),a.gallery_image_cache[i]}},set_fetch_interval:function(e){if(t.methods.is_open()&&null===this.ajax_interval){var i=this;this.ajax_interval=setInterval(function(){i.do_interval_fetch(e)},this.ajax_delay)}},do_interval_fetch:function(e){if(!(this.get_ajax_info(e).current>=1)){if(!t.methods.is_open()||e!==t.methods.get_state().gallery_id)return clearInterval(this.ajax_interval),void(this.ajax_interval=null);var i=t.methods.get_gallery_from_id(e);this.gallery_image_cache[e].length<i.images_list_count?(this.increment_ajax_page(e),this.fetch_images_from_ajax(e)):(clearInterval(this.ajax_interval),this.ajax_interval=null)}}},get_gallery_from_id:function(t){if("undefined"==typeof window.galleries)return null;var i=null;return e.each(galleries,function(e,n){n.ID==t&&(i=n)}),i},get_id_from_slug:function(t){var i=t;return"undefined"==typeof window.galleries?i:(e.each(galleries,function(e,n){n.slug==t&&(i=n.ID)}),i)},get_displayed_gallery_setting:function(e,t,i){var n="",a=this.get_gallery_from_id(e);return n=a&&"undefined"!=typeof a.display_settings[t]?a.display_settings[t]:i,1==n&&(n=!0),0==n&&(n=!1),n},router:{routes:[],interval:null,listen:function(e){var t=this;e=e||"";var i=function(){e!==t.get_fragment()&&(e=t.get_fragment(),t.match(e))};clearInterval(this.interval),this.interval=setInterval(i,50)},get_fragment:function(e){e=e||window.location.href;var t=e.match(/#(.*)$/),i=t?t[1]:"";return i.toString().replace(/\/$/,"").replace(/^\//,"")},navigate:function(e,t){t=t||!1,t&&clearInterval(this.interval),e=e?e:"",window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+e,t&&this.router.listen(this.router.get_fragment())},match:function(e){for(var i=e||this.get_fragment(),n=0;n<this.routes.length;n++){var a=i.match(this.routes[n].re);if(a)return a.shift(),this.routes[n].handler.apply(t.methods,a),this}},front_page_pushstate:function(i,n){if(!t.methods.get_setting("is_front_page")||void 0==i)return!1;if("undefined"==typeof window.galleries)return!1;var a="",s=i;return e.each(galleries,function(e,t){t.ID==i&&"undefined"!=typeof t.wordpress_page_root&&(a=t.wordpress_page_root,t.slug&&(s=t.slug))}),a+="#"+this.get_fragment(t.methods.get_setting("router_slug")+"/"+s+"/"+n),history.pushState?(history.pushState({},document.title,a),!0):(window.location=a,!1)}}}};this.core=t}var i=new t;e.nplModal=function(t){function n(e,t){for(var i=t.split(".");i.length;)e=e[i.shift()];return e}if("undefined"==typeof t)return i.core.init.apply(i,{});if("object"==typeof t)return i.core.init.apply(i,t);var a=n(i.core.methods,t);return a?a.apply(i.core.methods,Array.prototype.slice.call(arguments,1)):void e.error("Method "+t+" does not exist on jQuery.nplModal")}}(jQuery),jQuery(document).ready(function(e){e.nplModal()});